{% extends 'galaxy/base.html' %}
    {% load static %}
    {% load custom_filters %}
    {% block header %}
    <title>User Management</title>
    <link type="text/css" rel="stylesheet" href="{% static 'css/products_managment.css' %}"/>
    <script src="{% static 'js/products_managment.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% comment %} ------for save user------------- {% endcomment %}
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <style>
      button {
        background-color: #04AA6D;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        cursor: pointer;
        width: 100%;
        opacity: 0.9;
      }
      
      button:hover {
        opacity:1;
      }
      table, th, td {
        border: 1px solid black;
        border-collapse: collapse;}
      
    </style> 
    
    {% endblock header %}

{% block body %}

{% comment %} <div id ="header" class="sticky">
    <div class="orgrow">
      <strong><span class="title" style="float:left;color:green;cursor:pointer" onclick="openleftNav('userNav')">&#9776; <Strong>Select User</strong></span></strong>
      </div>
      <div class="orgrow">
      <div class="col-30"><a id="title" name="username" style=" color:darkgreen;font-size: large;font-weight: bold;text-align: left ">{% if the_user.username %}│{{the_user.email}}│{% endif %}{% if the_user and not the_user.email %}New User {% endif %}{% if not the_user %} {% endif %}</a></div>
      </div>
      <div class="orgrow">
      <div class="col-15"><a id="titleDiv1" onclick="gotodiv('Div1')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Basic Info </a></div>
      <div class="col-15"><a id="titleDiv2" onclick="gotodiv('Div2')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Rules </a></div>
      <div class="col-15"><a id="titleDiv3" onclick="gotodiv('Div3')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Modules Access </a></div>
      <div class="col-15"><a id="titleDiv4" onclick="gotodiv('Div4')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Access Times </a></div>
      <div class="col-15"><a id="titleDiv5" onclick="gotodiv('Div5')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Restrict IP </a></div>
      <div class="col-15"><a id="titleDiv6" onclick="gotodiv('Div6')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Opened Sessions </a></div>
      
    </div>
    
</div> {% endcomment %}

<div id ="header" class="sticky">
  <div class="orgrow">
    <strong><span class="title" style="float:left;color:green;cursor:pointer" onclick="openleftNav('userNav')">&#9776; <Strong>Select User</strong></span></strong>
  </div>
  <div class="orgrow">
    <div class="col-90" style="padding-left:12px;">
      <a id="title" name="username" style=" color:darkgreen;font-weight: bold;text-align: left ">{% if the_user.username %}│{{the_user.email}}│{% endif %}{% if the_user and not the_user.email %}New User {% endif %}{% if not the_user %} {% endif %}{% if the_user %}{% if the_user_sessions %}<span id="onlineEl-inner" class="online">&nbsp;&nbsp; online &nbsp;&nbsp;</span>{% else %}{% if the_user.email %}<span class="offline">&nbsp;&nbsp; offline &nbsp;&nbsp;</span>{% endif %}{% endif %}{% endif %}</a>
      {%if the_user %}<span onclick="statusshow()" style="margin-right:10px;margin-right:10px;color:blue;font-size:small;text-decoration:underline;cursor:pointer;">Status</span>{% endif %}
      {%if the_user %}<span id="userinfobtn" style="margin-right:10px;color:blue;font-size:small;text-decoration:underline;cursor:pointer;" onclick="info()"> Setup</span>{% endif %}
      {% if the_user.email %}<span style="margin-right:10px;color:blue;font-size:small;text-decoration:underline;cursor:pointer;" onclick="deleteProduct()" > Delete</span>{% endif %}
      </div>
  </div>
  <div id="statusrow" class="orgrow" style="display:none;">
  <div class="col-25" style="border-bottom: solid;border-color: blue">
    <label for="Status">Subscription Status</label>
    <a id="Status" name="Status" style=" color:blue; ">{% if the_user %}{% if sub_status %}Active{% else %}Inactive{% endif %}{% else %}{% endif %}</a>
  </div>
  
  <div  class="col-25" style="border-bottom: solid;border-color: blue">
    <label for="StartD">Start Date</label>
    <a id="StartD" name="StartD" style=" color:blue;">{% if sub_start %}{{sub_start}}{% endif %}</a>
  </div>
  
  <div class="col-25" style="border-bottom: solid;border-color: blue">
    <label for="EndD">End Date</label>
    <a id="EndD" name="EndD" style=" color:blue; ">{% if sub_end %}{{sub_end}}<span style="color: black; padding-left: 10px;"></span>{% endif %}</a>
  </div>
  
  <div  class="col-25" style="border-bottom: solid;border-color: blue">
    
    <label for="AutoRenew" >Auto Renew</label>
    {% if the_user %}  
      <input type="checkbox" id="autoRenewField" name="Auto-Renew" style=" color:blue " {% if form2.AutoRenew.value %} checked {% endif %}>
    {% endif %}
    
  </div>
</div>

  <div class="orgrow">
    <div class="col-15"><a id="titleDiv1" onclick="gotodiv('Div1')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Basic Info </a></div>
    <div class="col-15"><a id="titleDiv2" onclick="gotodiv('Div2')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Rules </a></div>
    <div class="col-15"><a id="titleDiv3" onclick="gotodiv('Div3')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Modules Access </a></div>
    <div class="col-15"><a id="titleDiv4" onclick="gotodiv('Div4')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Access Times </a></div>
    <div class="col-15"><a id="titleDiv5" onclick="gotodiv('Div5')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Restrict IP </a></div>
    <div class="col-15"><a id="titleDiv6" onclick="gotodiv('Div6')" style="color:darkgreen;display:none;text-align: center;cursor:pointer;">•  Opened Sessions </a></div>
</div>

</div>

{% comment %}  {% endcomment %}



      
<div  id="userNav" class="overlay">
  <a href="javascript:void(0)" class="closebtn" onclick="closeleftNav('userNav')">&times;</a>

  <div class="overlay-content">
    {% for user in users %}
        <a href="{% url 'manage_user' %}?id={{user.id}}"> {% if user.email %}{{user.email}}{% else %}Undefined User{% endif %}{% if user.id|active_sessions %}<span id="{{user.id}}" class="online">&nbsp;&nbsp; online &nbsp;&nbsp;</span>{% else %}{% if user.email %}<span class="offline">&nbsp;&nbsp; offline &nbsp;&nbsp;</span>{% endif %}{% endif %}</a>
    {% endfor %}
    <a href="{% url 'pricing' %}" style="font-size:xx-large;color:blue;" class="fa fa-cart-plus" ></a>  
  </div>
</div>

{% comment %} <div id="orgSubscription" class="container" style="padding-top:100px;position:relative; z-index: 2;">
  

              <div id="manage" class="orgrow" style="text-align: center;font-size:medium;font-weight:bold;">
                <div class="col-25" style="border-bottom: solid;border-color: blue">
                  <label for="Status">Subscription Status</label>
                  <a id="Status" name="Status" style=" color:blue; ">{% if the_user %}{% if sub_status %}Active{% else %}Inactive{% endif %}{% else %}{% endif %}</a>
                </div>
                
                <div  class="col-25" style="border-bottom: solid;border-color: blue">
                  <label for="StartD">Start Date</label>
                  <a id="StartD" name="StartD" style=" color:blue;">{% if sub_start %}{{sub_start}}{% endif %}</a>
                </div>
                
                <div class="col-25" style="border-bottom: solid;border-color: blue">
                  <label for="EndD">End Date</label>
                  <a id="EndD" name="EndD" style=" color:blue; ">{% if sub_end %}{{sub_end}}<span style="color: black; padding-left: 10px;"></span>{% endif %}</a>
                </div>
                
                <div  class="col-25" style="border-bottom: solid;border-color: blue">
                  
                      <label for="AutoRenew" >Auto Renew</label>
                      {% if the_user %}  
                        <input type="checkbox" id="autoRenewField" name="Auto-Renew" style=" color:blue " {% if form2.AutoRenew.value %} checked {% endif %}>
                      {% endif %}
                  
                </div>
              </div>
              <div id="manage1" class="orgrow" style="text-align: center;font-size:medium;font-weight:bold;">
                <div class="col-45" style="text-align: center;">
                  {% if the_user %}<button id="userinfobtn" type="button" style="width: 50%; float: right;" class="fa fa-arrow-circle-o-down btn" onclick="info()"> User Info</button>{% endif %}
                </div>
                <div class="col-45" style="text-align: center;">
      
                 {% if the_user.email %}<button type="button" style="width: 50%; float: right;" onclick="deleteProduct()" class="fa fa-remove btn"> Delete User</button>{% endif %}
                    
                </div>
              </div> {% endcomment %}

  <div id="productdeleteconfirm" class="deletemodal">
    <span onclick="document.getElementById('productdeleteconfirm').style.display='none';document.getElementById('deleteconfirmation').style.display='none'" class="deletemodel_close" title="Close Modal">x</span>
    <form class="deletemodal-content">
      <div class="container"  style="padding: 5px;text-align: center;">
        <h1 style="color: black;">User Data Delete Confirmation</h1>
        <p style="color: black;">Are you sure you want to delete User Data?</p>
        <p></p>
        <strong><h2 style="color: black;">Warning:</h2></strong>
        <Label style="color: black;"> User data will be permanently erased and you will not be able to access it again</label>
        <br>
        <div class="clearfix">
          
          <button id="user-delete-btn" name="user-delete-btn" type="button" onclick="document.getElementById('deleteconfirmation').style.display='block';document.getElementById('user-delete-btn').style.display='none'" class="modeldelete_deletebtn" style="margin : 0 auto">Delete</button>
          <br>
          <button id="remove-button" type="button" onclick="document.getElementById('productdeleteconfirm').style.display='none';document.getElementById('deleteconfirmation').style.display='none'" class="modeldelete_cancelbtn" style = "margin-top : 15px">Cancel</button>
          
          <div id="deleteconfirmation" style="display:none">
              <h4 style="color: black;">a confirmation code has been sent to your email</h4>
                  {% if error_message %}
                  <p style="color: red;">{{ error_message }}</p>
                  {% endif %}
  
                    <label style="color: black;" for="code">Confirmation Code:</label>
                    <input style="margin-bottom: 10px" type="text" id="code" name="code" required>
                    <a id="code-error" style="color: red"></a><br>
                    <button class="modeldelete_deletebtn userdel" data-user-id = "{{choosed_user}}" type="submit">Confirm Delete</button>
                  
                  
  
          </div>
        </div>
      </div>
    </form>
  </div>
  
  <form method = 'POST' id="system-user-form" enctype="multipart/form-data">
  {% csrf_token %}
  
  <div id="info" style="position:relative;top:65px;display:none;"> 
    <div  class="accordion">
      {% comment %} <a id="Div1" onclick="toggleMaxHeight('subbasicinfo', '1200px')" class="fa fa-arrow-circle-down accordion-toggle">
        Basic Info
        <span>
          <button style="float: right" class="btn1" id="cancel-btn" type="button">Cancel</button>
          <button style="float: right; margin-right: 10px;" class="btn1" name="user-save-btn" type="submit" value="Save">
            {% if the_user.username %}Update {% else %}Save{% endif %}
          </button>
        </span>
      </a> {% endcomment %}
    <div>
      <a id="Div1" onclick="toggleMaxHeight('subbasicinfo', '1200px', '1200px'), arrowdirection(id)" class="fa fa-arrow-circle-down accordion-toggle">
        <span style="display: inline-block; vertical-align: middle;">
          Basic Info
        </span>
        <span style="position: relative;top: -13px;">
          <button id="subbasicinfoCancel" style="margin-right: 10px;display:none;"class="btn3 usercancelbtn" type="button" data-user-id = "{{choosed_user}}">Cancel</button>
          <button id="subbasicinfoSave" style="margin-right: 10px;display:none;" class="btn3 usersavebtn" name="user-save-btn" type="submit" value="Save" data-user-id = "{{choosed_user}}">
            {% if the_user.username %}Update {% else %}Save{% endif %}
          </button>
        </span>
      </a>
    </div>
          <div id="subbasicinfo" class="accordion-content" style="max-height: 0px;">
            <div class="accordion-inner">
                      <div class="orgrow">
                        <div class="col-75">
                          <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;" >Active :</label></strong>
                          {{form.system_user_active}}
                          {% if form.system_user_active.errors %}
                            <ul class="errorlist" style="color: red">
                              {% for error in form.system_user_active.errors %}
                                <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </div>
                      </div>
              <div class="col-50" >
                    <div class="orgrow"> 
                      <div class="orgrow">
                        <div class="col-30">
                          <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">User Type :</label></strong>
                        </div>
                        <div class="col-65">
                          {{form.user_Type}}
                          {% if form.user_Type.errors %}
                            <ul class="errorlist" style="color: red">
                              {% for error in form.user_Type.errors %}
                                <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </div>
                      </div>
                      <div class="orgrow">
                        <div class="col-30">
                          <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">User Name :</label></strong>
                        </div>
                        <div class="col-65">
                          {{form.username}}
                          {% if form.username.errors %}
                            <ul class="errorlist" style="color: red">
                              {% for error in form.username.errors %}
                                <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </div>
                      </div>
                      <div class="orgrow">
                        <div class="col-30">
                          <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">First Name :</label></strong>
                        </div>
                        <div class="col-65">
                          {{form.first_name}}
                          {% if form.first_name.errors %}
                            <ul class="errorlist" style="color: red">
                              {% for error in form.first_name.errors %}
                                <span style="color: red; padding-left: 60px;">• {{ error }}</span><li>{{ error }}</li>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </div>
                      </div>
                      <div class="orgrow">
                        <div class="col-30">
                          <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">Last Name :</label></strong>
                        </div>
                        <div class="col-65">
                            {{form.last_name}}
                            {% if form.last_name.errors %}
                            <ul class="errorlist" style="color: red">
                              {% for error in form.last_name.errors %}
                                <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </div>
                      </div>
                      <div class="orgrow">
                        <div class="col-30">
                          <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">User E-mail :</label></strong>
                        </div>
                        <div class="col-65">
                          {{form.email}}
                          {% if form.email.errors %}
                            <ul class="errorlist" style="color: red">
                              {% for error in form.email.errors %}
                                <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </div>
                      </div>
                      <div class="orgrow">
                        <div class="col-30">
                          <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">Gender :</label></strong>
                        </div>
                        <div class="col-65">
                          {{form.Gender}}
                          {% if form.Gender.errors %}
                            <ul class="errorlist" style="color: red">
                              {% for error in form.Gender.errors %}
                                <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </div>
                      </div>
                  </div>
              </div>    
                
              <div class="col-45">        
                    <div class="orgrow">
                      <div class="col-30">
                        <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">Language :</label></strong>
                      </div>
                      <div class="col-65">
                        {{form.Language}}
                        {% if form.Language.errors %}
                          <ul class="errorlist" style="color: red">
                            {% for error in form.Language.errors %}
                              <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                            {% endfor %}
                          </ul>
                        {% endif %}
                      </div>
                    </div>
                    
                    <div class="orgrow">
                      <div class="col-30">
                        <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">Birth Date :</label></strong>
                      </div>
                      <div class="col-65">
                        {{form.Birth_Date}}
                        {% if form.Birth_Date.errors %}
                          <ul class="errorlist" style="color: red">
                            {% for error in form.Birth_Date.errors %}
                              <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                            {% endfor %}
                          </ul>
                        {% endif %}
                      </div>
                    </div>
                    <div class="orgrow">
                      <div class="col-30">
                        <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">Telephone :</label></strong>
                      </div>
                      <div class="col-65">
                        {{form.Telephone}}
                        {% if form.Telephone.errors %}
                          <ul class="errorlist" style="color: red">
                            {% for error in form.Telephone.errors %}
                              <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                            {% endfor %}
                          </ul>
                        {% endif %}
                      </div>
                    </div>
                    <div class="orgrow">
                      <div class="col-30">
                        <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">Password :</label></strong>
                      </div>
                      <div class="col-65">
                        {{form.password}}
                        {% if form.password.errors %}
                          <ul class="errorlist" style="color: red">
                            {% for error in form.password.errors %}
                            <span style="color: red; padding-left: 60px;">• {{ error }}</span>
                            {% endfor %}
                          </ul>
                        {% endif %}
                        
                            <div id="pswMessage">
                                <h3 style="font-size:10px">Password must contain the following: </h3>
                                <p id="lab1" style="background-color:inherit">✖ capital letters,</p> 
                                <p id="lab2" >✖ small letters,</p> 
                                <p id="lab3" >✖ special character,</p>
                                <p id="lab4" >✖ number,</p>
                                <p id="lab5" >✖ not less than 8 character.</p>
                            </div>
                      </div>
                    </div>
            
                  
                  
                    <div class="orgrow">
                      <div class="col-30">
                        <strong><label style="text-decoration: underline;padding: 0px 20px 0px 0px;">Repeat Password :</label></strong>
                      </div>
                      <div class="col-65">
                        <input type="password" name="psw-repeat" onfocus="showPswMatchMsg()" onblur="hidePswMatchMsg()" onkeyup="ChangePswMsgStatus(psw.value)" placeholder="Repeat Password..." id="psw-repeat">
                              <!--  <i class="fa-solid fa-eye" id="eye2"></i> -->
                            <div id="pswMatchMsg">
                                <p id="lab6" >✖ Password Matches</p>
                            </div>
                      </div>
                      
                    </div>
            
                  </div>
                    <p></p>
                          
                    <div class="passerror">
                      {% if pass_error_user %}
                        {% for error in pass_error_user %}
                          {{error}}<br>
                        {% endfor %}
                      {% endif %}
                    </div>
                  
                    
                <p></p>

              <p></p>      
              </div>
            </div>
          </div>
     

        <div  class="accordion">  
          <a id="Div2" onclick= "toggleMaxHeight('Rules', '1200px', '1200px'),arrowdirection(id)" class="fa fa-arrow-circle-down accordion-toggle"> Rules </a>
            <div id="Rules" class="accordion-content" style="max-height: 0px;">
              <div class="accordion-inner">
                <div class="orgrow">
                  <a>New Rules</a>; 
                </div>
              </div>
            </div>
        </div>


          
  

        <div  class="accordion">    
            <a id="Div3" onclick="toggleMaxHeight('modulesaccess', '1200px', '1200px'), arrowdirection(id)" class="fa fa-arrow-circle-down accordion-toggle"> Modules Access </a>
            <div id="modulesaccess" class="accordion-content" style="max-height: 0px;">
              <br>
              <div class="accordion-inner">
                  <div class="orgrow">
                    <div class="col-50" >
                      <label style="text-decoration: underline;" for="module">Select Module :</label>
                        <select id="module" name="module">
                          {% for sub in user_subs_basic %}
                            <option id="{{sub.ProductID.Name}}" value="{{sub.ProductID.Name}}">{{sub.ProductID.Name}}</option>
                          {% endfor %}
                        </select>
                        <button style="margin-right: 10px;" onclick="addnewmodule()" class="btn1" type="button">Add</button>
                    </div>
                    
                    {% comment %} <div class="col-15" style="display: inline-block;color :green;padding-left: 20px">
                        <span onclick="addnewmodule()" class="btn1" style="padding: 12px 12px 12px 0;display: inline-block;text-align: center;">Add</span>
                    </div> {% endcomment %}
                    <div class="col-50">
                      <label style="text-decoration: underline;display:block;" for="module">Allowed Modules :</label>
                          <ul id="mymoduleUL">
                            {% if user_module %}
                              {% for module in user_module %}
                              <li class="{{module.module_name}}" data-module-name="{{module.module_name}}" id="{{module.module_name}}">{{module.module_name}}<span class="closeLI module-del">×</span></li>
                              {% endfor %}
                            {% endif %}
                          </ul>
                              
                    </div>
                  </div>
              </div>
              <br>
            </div>
        </div>
      

        <div  class="accordion"> 
          <a id="Div4" onclick="toggleMaxHeight('security', '1200px', '1200px'), arrowdirection(id)" class="fa fa-arrow-circle-down accordion-toggle"> Access Time </a>
            <div id="security" class="accordion-content" style="max-height: 0px;">
              <div class="accordion-inner">
                <div class="orgrow">
                  <label> All times are allowed except the days listed here :</label><br>
                  <div class="col-50" >
                    <label style="text-decoration: underline;" >Select Day :</label><br>
                    <select name="weekdays" id="weekdays" >
                      <option value="Saturday">Saturday</option>
                      <option value="Sunday">Sunday</option>
                      <option value="Monday">Monday</option>
                      <option value="Tuesday">Tuesday</option>
                      <option value="Wednesday">Wednesday</option>
                      <option value="Thursday">Thursday</option>
                      <option value="Friday">Friday</option>
                    </select><br>
                    <label> Allowed times :</label><br>
                    <label style="margin-right:10px">from :</label>
                    <input id="start-time" type="time" name="aftertime"></dt>
                    <label style="margin-right:10px;margin-left:10px">To :</label>
                    <input id="end-time" type="time" name="befortime"></dt>
                    <br>  
                    <button id="check-time-btn" style="margin-right: 10px;"  class="btn1 timerestrictbtn" type="button" data-user-id = "{{choosed_user}}" >Add</button> 
                  </div>
                  
                  {% comment %} <div class="col-15" style="display: inline-block;color :green;padding-left: 20px">
                      <span onclick="addnewmodule()" class="btn1" style="padding: 12px 12px 12px 0;display: inline-block;text-align: center;">Add</span>
                  </div> {% endcomment %}
                  <div class="col-50">
                    <label> Allowed times for Excluded days :</label><br>
                        <ul id="allowedtimeUL">
                          {% if time_restrictions %} 
                            {% for time_restriction in time_restrictions %}
                              <li id = "{{time_restriction.day_of_week}}" data-day-name="{{time_restriction.day_of_week}}">{{time_restriction.day_of_week}} from [{{time_restriction.start_time|time:"g:i A"}}] to [{{time_restriction.end_time|time:"g:i A"}}] <span data-day-name="{{time_restriction.day_of_week}}" class="closeLI timerestrict-del">×</span></li>
                            {% endfor %}
                          {% endif %} 
                        </ul>
                            
                  </div>
                </div>
            </div>
          </div>
      </div>


        {% comment %} <div  class="accordion"> 
            <a id="Div4" onclick="toggleMaxHeight('security', '1200px', '1200px'), arrowdirection(id)" class="fa fa-arrow-circle-down accordion-toggle"> Access Time </a>
              <div id="security" class="accordion-content" style="max-height: 0px;">
                <div class="accordion-inner">
                  <div class="orgrow">
                    <div class="col-25">
                        <label for="weekdays"><b>User Access Time :</b></label>
                    </div>
                  </div>
                  <div class="orgrow">
                    <div id="weekdays" class="col-90" style="padding-left:10%">
                      <dl>
                          <dt>Saturday</dt>
                            <div class="orgrow">
                              <div class="col-25" >
                                <dd><a> From :</a> <input type="time" name="aftertime" value="{{ time_restrictions.Saturday.0 }}"></dd>
                              </div>
                              <div class="col-25" >
                                <dd><a> To :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a> <input type="time" name="befortime" value="{{ time_restrictions.Saturday.1 }}"></dd>
                              </div>
                            </div>
                          <dt>Sunday</dt>
                          <div class="orgrow">
                              <div class="col-25" >
                                <dd><a> From :</a> <input type="time" name="aftertime" value="{{ time_restrictions.Sunday.0 }}"></dd>
                              </div>
                              <div class="col-25" >
                                <dd><a> To :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a> <input type="time" name="befortime" value="{{ time_restrictions.Sunday.1 }}"></dd>
                              </div>
                          </div>
                          <dt>Monday</dt>
                          <div class="orgrow">
                            <div class="col-25" >
                              <dd><a> From :</a> <input type="time" name="aftertime" value="{{ time_restrictions.Monday.0 }}"></dd>
                            </div>
                            <div class="col-25" >
                              <dd><a> To :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a> <input type="time" name="befortime" value="{{ time_restrictions.Monday.1 }}"></dd>
                            </div>
                          </div>
                          <dt>Tuesday</dt>
                          <div class="orgrow">
                            <div class="col-25" >
                              <dd><a> From :</a> <input type="time" name="aftertime" value="{{ time_restrictions.Tuesday.0 }}"></dd>
                            </div>
                            <div class="col-25" >
                              <dd><a> To :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a> <input type="time" name="befortime" value="{{ time_restrictions.Tuesday.1 }}"></dd>
                            </div>
                          </div>
                          <dt>Wednesday</dt>
                          <div class="orgrow">
                            <div class="col-25" >
                              <dd><a> From :</a> <input type="time" name="aftertime" value="{{ time_restrictions.Wednesday.0 }}"></dd>
                            </div>
                            <div class="col-25" >
                              <dd><a> To :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a> <input type="time" name="befortime" value="{{ time_restrictions.Wednesday.1 }}"></dd>
                            </div>
                          </div>
                          <dt>Thursday</dt>
                          <div class="orgrow">
                            <div class="col-25" >
                              <dd><a> From :</a> <input type="time" name="aftertime" value="{{ time_restrictions.Thursday.0 }}"></dd>
                            </div>
                            <div class="col-25" >
                              <dd><a> To :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a> <input type="time" name="befortime" value="{{ time_restrictions.Thursday.1 }}"></dd>
                            </div>
                          </div>
                          <dt>Friday</dt>
                          <div class="orgrow">
                            <div class="col-25" >
                              <dd><a> From :</a> <input type="time" name="aftertime" value="{{ time_restrictions.Friday.0 }}"></dd>
                            </div>
                            <div class="col-25" >
                              <dd><a> To :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a> <input type="time" name="befortime" value="{{ time_restrictions.Friday.1 }}"></dd>
                            </div>
                          </div>
                        </div>
                      </dl>  
                    </div>
                    <div class="orgrow">
                      <div class="col-90"> 
                      <button style="float: right; margin-left: 17px;" class="btn1" id="time-restrict-btn" type="button">Save</button><button style="float: right;" class="btn1" id="remove-restrict-btn" type="button">Remove all</button>
                      </div>
      
                </div>
              </div>
            </div>
          </div> {% endcomment %}

          <div  class="accordion">
              <a id="Div5" onclick="toggleMaxHeight('restrictip', '1200px', '1200px'), arrowdirection(id)" class="fa fa-arrow-circle-down accordion-toggle"> Restrict IP </a>
                <div id="restrictip" class="accordion-content" style="max-height: 0px;">
                  <div class="accordion-inner"> 
                    <input type="radio" id="allowips" name="age" value="Allow" onclick="document.getElementById('restrictipssection').style.display='none'" {% if not the_user.ip_restricted %}checked{% endif %}>
                    <label for="allowips">Allow all IPs</label><br>
                    <input type="radio" id="restrictips" name="age" value="Restrict" {% if the_user.ip_restricted %}checked {% endif %}>
                    <label for="restrictips">Restrict user login to the IPs specified here.</label><br>   

                    <div class="orgrow" id="restrictipssection" style="display:none">
                      {% comment %} <label >Multiple IPs can be added separated by commas.</label><br> {% endcomment %}
                      <div class="col-50">
                        <label style="text-decoration: underline;" for="ips">Add IPs :</label>
                        <input type="text" id="ips" name="ips" placeholder="IP Address...">
                        <button style="margin-right: 10px;" onclick="ValidateIPaddress(ips)" class="btn1" type="button">Add</button>
                      </div>
                      {% comment %} <div class="col-20" style="display: inline-block;color :green;padding-left: 20px">
                          <span onclick="ValidateIPaddress(ips)" class="btn1" style="text-align: center;padding: 12px 12px 12px 0;display: inline-block;text-align: center;">Add</span>
                      </div> {% endcomment %}
                    <div class="col-50">
                        <label style="text-decoration: underline;display:block;">Allowed IPs :</label> 
                            <ul id="myipUL">
                              {% if ip_addresses %}
                                {% for address in ip_addresses %}
                                <li class="ip-address" data-ip-address="{{address.ip_address}}" id="{{address.ip_address}}">{{address.ip_address}}<span id = "{{address.ip_address}}" class="closeLI ip-del">×</span></li>
                                {% endfor %}
                              {% endif %}

                            </ul>
                                
                    </div>
                    </div>
              </div>
            </div>
          </div>  

          <div  class="accordion">        
            <a id="Div6" onclick="toggleMaxHeight('OpendSessions', '1200px', '1200px'), arrowdirection(id)" class="fa fa-arrow-circle-down accordion-toggle"> Opend Sessions </a>
              <div id="OpendSessions" class="accordion-content" style="max-height: 0px;">
                <div class="accordion-inner">
                    <div class="orgrow" >
                        <label> The opened sessions for the current user is displayed here.</label> 
                    </div>
                    <div class="orgrow" >
                      <table id = "sessions-table" style="width:100%;text-align:center">
                        <tr class="tableHeader">
                          <th>Session ID</th>
                          <th>IP Address</th> 
                          <th>Location</th>
                          <th>Opened Date/time</th>
                          <th> </th>
                        </tr>
                        {% for session in the_user_sessions_info %}
                          <tr id="{{ session.session_id }}" class="tableRow">
                            <td>{{ session.session_id }}</td>
                            <td>{{ session.ip_address }}</td>
                            <td>{{ session.location }}</td>
                            <th>{{ session.start_time }}</th>
                            <th><button style="width:50%;padding:0;margin:0px 0px 0px 0px;box-shadow:none;border:none;margin-right: 10px;" onclick="" class="btn1 session-del-btn" data-session-id="{{session.session_id}}" type="button">Colse</button></th>
                          </tr>
                        {% endfor %}
                        
                      </table>
                  </div>
                </div>
              </div>
        </div>
 </form>
  
</div>
   
{% endblock body %}
{% block additional %}
{% comment %} ----------------------make the time restriction with js-------------------------------- {% endcomment %}
<script>
  function convertTo12HourFormat(time) {
    // Extract hours and minutes
    var [hours, minutes] = time.split(':');

    // Convert to 12-hour format
    var period = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12 || 12; // Handle midnight (00:00)

    // Return formatted time
    return `${hours}:${minutes} ${period}`;
  }

  document.getElementById("weekdays").value = "";
  const addButton = document.querySelector('.timerestrictbtn');
  // Attach an event listener to the delete button
  addButton.addEventListener('click', (event) => {
    event.preventDefault(); // Prevent the default behavior of the button click
    var userId = addButton.dataset.userId;
    var li = document.createElement("li");
    var day = document.getElementById("weekdays").value;
    var startTime = document.getElementById("start-time").value;
    var endTime = document.getElementById("end-time").value;
    li.id = day;
    var t = document.createTextNode(day +" "+"from [" + convertTo12HourFormat(startTime) + "] to [" + convertTo12HourFormat(endTime) + "]");
    li.appendChild(t);
  
    var ul = document.getElementById("allowedtimeUL");
    var lis = ul.getElementsByTagName("li");
    var specificId = day;
  
    if (startTime >= endTime){
      alertify.set('notifier', 'position', 'top-center');
      alertify.error("error in timeeeeee!");
    }else{


    for (var i = 0; i < lis.length; i++) {
      var lii = lis[i];
      var liId = lii.getAttribute("id");
      console.log(liId)
      if (liId === specificId) {
        lii.innerHTML = `${day} from [${convertTo12HourFormat(startTime)}] to [${convertTo12HourFormat(endTime)}] <span data-day-name="${day}" class="closeLI timerestrict-del">×</span>`

        var newCloseButtons = document.querySelectorAll('.timerestrict-del');

        newCloseButtons.forEach(span => {
          span.addEventListener('click', (event) => {
              event.preventDefault();
              var span = event.target;
              var li = span.closest('li');
              var dayName = span.dataset.dayName;

              const url = `/remove_time_restrictions/?id=${userId}&day=${dayName}`;
              // Make an asynchronous request to delete the product from the server
              fetch(url, {
                method: 'DELETE',
                headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
                },
              })
                .then(response => response.json())
                .then(data => {
                  // Handle the response data
                  // For example, display a success message or update the cart UI
                  if (data.success) {
                    // Handle the success response
                    li.remove()
                    alertify.set('notifier', 'position', 'top-center');
                    alertify.error(data.message);
                  }
                  })
              
                .catch(error => {
                  // Handle any errors that occurred during the request
                  console.error(error);
                });

              li.remove();
          });
        });


        /* var li = document.createElement("li");
        var day = document.getElementById("weekdays").value;
        var startTime = document.getElementById("start-time").value;
        var endTime = document.getElementById("end-time").value;
        li.id = day;
        var t = document.createTextNode(day +" "+"from [" + convertTo12HourFormat(startTime) + "] to [" + convertTo12HourFormat(endTime) + "]");
        li.appendChild(t);
        ul.appendChild(li);
        
        var span = document.createElement("span");
        var txt = document.createTextNode("\u00D7");
        span.setAttribute("data-day-name", `${day}`);
        span.className = "closeLI timerestrict-del";
        span.appendChild(txt);
        
        li.appendChild(span);
        li.setAttribute("data-day-name", `${day}`);*/
        const url = `/time_restrictions/${userId}/${day}/${startTime}/${endTime}`;
  
        // Make an asynchronous request to delete the product from the server
        fetch(url, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
          },
        })
          .then(response => response.json())
          .then(data => {
            // Handle the response data
            // For example, display a success message or update the cart UI
            if (data.success) {
              
              alertify.set('notifier', 'position', 'top-center');
              alertify.success(data.message);
            } else if (data.error) {
              alertify.set('notifier', 'position', 'top-center');
              alertify.error(data.message);
            }
          })
          .catch(error => {
            // Handle any errors that occurred during the request
            console.error(error);
          });
        return;
      }
    }
  


    ul.appendChild(li);
     //if (startTime < endTime) {var userId = addButton.dataset.userId;
    console.log('nooooo');
    var day = document.getElementById('weekdays').value;
    console.log(day);
    var startTime = document.getElementById('start-time').value;
    console.log(startTime);
    var endTime = document.getElementById('end-time').value;
    console.log(endTime);
   
       // Construct the URL with the confirmation code as a query parameter
      const url = `/time_restrictions/${userId}/${day}/${startTime}/${endTime}`;

    // Make an asynchronous request to delete the product from the server
    fetch(url, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
      },
    })
      .then(response => response.json())
      .then(data => {
        // Handle the response data
        // For example, display a success message or update the cart UI
        if (data.success) {
          
          alertify.set('notifier', 'position', 'top-center');
          alertify.success(data.message);
        } else if (data.error) {
          alertify.set('notifier', 'position', 'top-center');
          alertify.error(data.message);
        }
      })
      .catch(error => {
        // Handle any errors that occurred during the request
        console.error(error);
      });

  var span = document.createElement("span");
  var txt = document.createTextNode("\u00D7");
  span.setAttribute("data-day-name", `${day}`);
  span.className = "closeLI timerestrict-del";
  
  span.appendChild(txt);
  li.appendChild(span);
}

  var close = document.getElementsByClassName("timerestrict-del");
  for (var i = 0; i < close.length; i++) {
    close[i].onclick = function(event) {
      var span = event.target;
      var li = span.closest('li'); // Find the closest ancestor li element
      var dayName = span.dataset.dayName; // Retrieve the day name from the parent li element

    li.remove(); // Remove the li element

      const url = `/remove_time_restrictions/?id=${userId}&day=${dayName}`;

      // Make an asynchronous request to delete the product from the server
      fetch(url, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
        },
      })
        .then(response => response.json())
        .then(data => {
          // Handle the response data
          // For example, display a success message or update the cart UI
          if (data.success) {
            // Handle the success response
            li.remove()
            alertify.set('notifier', 'position', 'top-center');
            alertify.error(data.message);
          }
          })
      
        .catch(error => {
          // Handle any errors that occurred during the request
          console.error(error);
        });


      };
    }
  });

   //-------------------------------the delete part (when refresh)--------------------------- 
  const timeRemoveButtons = document.querySelectorAll('.timerestrict-del');

  // Attach an event listener to the delete button
  timeRemoveButtons.forEach(span => {
    span.addEventListener('click', (event) => {
      event.preventDefault(); // Prevent the default behavior of the button click
    // Construct the URL with the confirmation code as a query parameter
    var queryString = window.location.search;
    // Create a new instance of URLSearchParams with the query string
    var searchParams = new URLSearchParams(queryString);
    // Get the value of the "param" query parameter
    var paramValue = searchParams.get('id');

    li = span.parentElement
    const dayName = li.dataset.dayName;

    const url = `/remove_time_restrictions/?id=${encodeURIComponent(paramValue)}&day=${dayName}`;

    // Make an asynchronous request to delete the product from the server
    fetch(url, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
      },
    })
      .then(response => response.json())
      .then(data => {
        // Handle the response data
        // For example, display a success message or update the cart UI
        if (data.success) {
          // Handle the success response
          li.remove()
          alertify.set('notifier', 'position', 'top-center');
          alertify.error(data.message);
        }
        })
    
      .catch(error => {
        // Handle any errors that occurred during the request
        console.error(error);
      });
  });
  });


  </script>
  {% comment %} -------------------------------------------------------------------------------------- {% endcomment %}

<script>
  document.getElementById('autoRenewField').addEventListener('change', function() {
    // Check if the checkbox is checked
    var autoRenewCheckbox = document.getElementById('autoRenewField');
    var isAutoRenewChecked = autoRenewCheckbox.checked;
    console.log('hello')
    // Construct the URL with the confirmation code as a query parameter
    var queryString = window.location.search;
    // Create a new instance of URLSearchParams with the query string
    var searchParams = new URLSearchParams(queryString);
    // Get the value of the "param" query parameter
    var paramValue = searchParams.get('id');
    
    // Do something based on the checkbox state
    if (isAutoRenewChecked) {
      console.log('hello2')
      
      const url = `/user_autorenow_on?id=${encodeURIComponent(paramValue)}`;
      // Make an asynchronous request to delete the product from the server
      fetch(url, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
        },
      })
        .then(response => response.json())
        .then(data => {
          // Handle the response data
          // For example, display a success message or update the cart UI
          if (data.success) {
            // Handle the success response
            alertify.set('notifier', 'position', 'top-center');
            alertify.success(data.message);
          }
        })
        .catch(error => {
          // Handle any errors that occurred during the request
          console.error(error);
        });
      
    } else {
      console.log('hello3')
      
      const url = `/user_autorenow_off?id=${encodeURIComponent(paramValue)}`;
      // Make an asynchronous request to delete the product from the server
      fetch(url, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
        },
      })
        .then(response => response.json())
        .then(data => {
          // Handle the response data
          // For example, display a success message or update the cart UI
          if (data.success) {
            // Handle the success response
            alertify.set('notifier', 'position', 'top-center');
            alertify.error(data.message);
          }
        })
        .catch(error => {
          // Handle any errors that occurred during the request
          console.error(error);
        });
     
    }
  });
</script>

<script>
  document. addEventListener('mouseup', function(e) {
    var container = document. getElementById('userNav');
    if (! container. contains(e. target)) {
    container. style.width = "0%";
    }
    });
</script>



<script>
  // Wait for the DOM to load
  document.addEventListener('DOMContentLoaded', function() {
      // Select all the messages with the 'alert' class
      var messages = document.querySelectorAll('.alert');

      // Loop through each message and set a timeout to remove it after 3 seconds,
      // except for error messages
      messages.forEach(function(message) {
          if (!message.classList.contains('error')) {
              setTimeout(function() {
                  message.remove();
              }, 3000);
          }
      });
  });
</script>
<script>
  var message = document.getElementById('fade-msg');
  if (!message.classList.contains('error')) {
      setTimeout(function() {
        message.style.opacity = '0';
      }, 1250);
  }
</script>
<script>
  var coll = document.getElementsByClassName("smallcontainer");
  var i;
  
  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.maxHeight){
        content.style.maxHeight = null;
      } else {
        content.style.maxHeight = content.scrollHeight + "px";
      } 
    });
  }
</script>  
<script>
  // ------------------- add ip address --------------------------------------------------------------------------------------------------       
   function ValidateIPaddress(inputText){
   var ipformat = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
   if(inputText.value.match(ipformat))
   {
   document.getElementById("ips").focus();
   addnewip();
   }
   else
   {
    alertify.set('notifier', 'position', 'top-center');
    alertify.error("Invalid IP Address!");
   document.getElementById("ips").focus();return false;
   }
   }
  
  // Create a new list item when clicking on the "Add" button--------
  function addnewip() {
    var li = document.createElement("li");
    var inputValue = document.getElementById("ips").value;
    li.id = inputValue;
    li.setAttribute("data-ip-address", `${inputValue}`);
    var t = document.createTextNode(inputValue);
    li.appendChild(t);
    
    
    if (inputValue === '') {
      alertify.set('notifier', 'position', 'top-center');
      alertify.error('You must add IP Address!');
      return;
    }
    var ul = document.getElementById("myipUL");
    var lis = ul.getElementsByTagName("li");
    var specificIp = inputValue;

    for (var i = 0; i < lis.length; i++) {
      var lii = lis[i];
      var liId = lii.getAttribute("id");
    
      if (liId === specificIp) {
        alertify.set('notifier', 'position', 'top-center');
        alertify.error('IP Address already allowed to this user !');
        return;
      }
    }
      
    ul.appendChild(li);
    
    var queryString = window.location.search;
    // Create a new instance of URLSearchParams with the query string
    var searchParams = new URLSearchParams(queryString);
    // Get the value of the "param" query parameter
    var paramValue = searchParams.get('id');
    
    const url = `/add_allow_ip?id=${encodeURIComponent(paramValue)}&ip_address=${encodeURIComponent(inputValue)}`;

    // Make an asynchronous request to delete the product from the server
    fetch(url, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
      },
    })
      .then(response => response.json())
      .then(data => {
        // Handle the response data
        // For example, display a success message or update the cart UI
        if (data.success) {
          // Handle the success response
          alertify.set('notifier', 'position', 'top-center');
          alertify.success(data.message);
        }
      })
      .catch(error => {
        // Handle any errors that occurred during the request
        console.error(error);
      });
    
      document.getElementById("ips").value = "";
  
    var span = document.createElement("span");
    var txt = document.createTextNode("\u00D7");
    span.className = "closeLI ip-del";
    
    span.appendChild(txt);
    li.appendChild(span);
    var close = document.getElementsByClassName("ip-del");
    for (i = 0; i < close.length; i++) {
      close[i].onclick = function(event) {
        var span = event.target;
        var div = span.parentElement;
        var ipAddress = div.dataset.ipAddress; // Retrieve the module name from the parent li element
        console.log(ipAddress)
        console.log('okkk')
        div.remove();

        const url = `/delete_allow_ip?id=${encodeURIComponent(paramValue)}&ip_address=${ipAddress}`;

        // Make an asynchronous request to delete the product from the server
        fetch(url, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
          },
        })
          .then(response => response.json())
          .then(data => {
            // Handle the response data
            // For example, display a success message or update the cart UI
            if (data.success) {
              // Handle the success response
              alertify.set('notifier', 'position', 'top-center');
              alertify.error(data.message);
            }
          })
          .catch(error => {
            // Handle any errors that occurred during the request
            console.error(error);
          });


      };
     }
  }
  //------------------ add module ------------------------------------------------------------------------------------------------------
  
  document.getElementById("module").value = "";
  function addnewmodule() {
    var li = document.createElement("li");
    var inputValue = document.getElementById("module").value;
    li.id = inputValue;
    li.setAttribute("data-module-name", `${inputValue}`);
    var t = document.createTextNode(inputValue);
    li.appendChild(t);


    if (inputValue === '') {
      alertify.set('notifier', 'position', 'top-center');
      alertify.error('You must select a module!');
      return;
    }
  
    var ul = document.getElementById("mymoduleUL");
    var lis = ul.getElementsByTagName("li");
    var specificId = inputValue;
  
    for (var i = 0; i < lis.length; i++) {
      var lii = lis[i];
      var liId = lii.getAttribute("id");
  
      if (liId === specificId) {
        alertify.set('notifier', 'position', 'top-center');
        alertify.error('User already allowed to this module!');
        return;
      }
    }
  
    ul.appendChild(li);

    var queryString = window.location.search;
    // Create a new instance of URLSearchParams with the query string
    var searchParams = new URLSearchParams(queryString);
    // Get the value of the "param" query parameter
    var paramValue = searchParams.get('id');
    
    const url = `/add_allow_module?id=${encodeURIComponent(paramValue)}&module_name=${encodeURIComponent(inputValue)}`;

    // Make an asynchronous request to delete the product from the server
    fetch(url, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
      },
    })
      .then(response => response.json())
      .then(data => {
        // Handle the response data
        // For example, display a success message or update the cart UI
        if (data.success) {
          // Handle the success response
          alertify.set('notifier', 'position', 'top-center');
          alertify.success(data.message);
        }
      })
      .catch(error => {
        // Handle any errors that occurred during the request
        console.error(error);
      });

      document.getElementById("module").value = "";

  var span = document.createElement("span");
  var txt = document.createTextNode("\u00D7");
  span.className = "closeLI module-del";
 
  span.appendChild(txt);
  li.appendChild(span);
 
  var close = document.getElementsByClassName("module-del");
  for (var i = 0; i < close.length; i++) {
    close[i].onclick = function(event) {
      var span = event.target;
      var li = span.parentElement;
      var moduleName = li.dataset.moduleName; // Retrieve the module name from the parent li element
      li.remove();

        const url = `/delete_allow_module?id=${encodeURIComponent(paramValue)}&module_name=${moduleName}`;

        // Make an asynchronous request to delete the product from the server
        fetch(url, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
          },
        })
          .then(response => response.json())
          .then(data => {
            // Handle the response data
            // For example, display a success message or update the cart UI
            if (data.success) {
              // Handle the success response
              alertify.set('notifier', 'position', 'top-center');
              alertify.error(data.message);
            }
          })
          .catch(error => {
            // Handle any errors that occurred during the request
            console.error(error);
          });


      };
    }
  }
</script>

<script>

  const moduleRemoveButtons = document.querySelectorAll('.module-del');

  // Attach an event listener to the delete button
  moduleRemoveButtons.forEach(span => {
    span.addEventListener('click', (event) => {
      event.preventDefault(); // Prevent the default behavior of the button click

    // Get the product ID associated with the delete button
    li = span.parentElement
    
    var moduleName = li.dataset.moduleName;
    console.log(moduleName);
    
    // Construct the URL with the confirmation code as a query parameter
    var queryString = window.location.search;
    // Create a new instance of URLSearchParams with the query string
    var searchParams = new URLSearchParams(queryString);
    // Get the value of the "param" query parameter
    var paramValue = searchParams.get('id');

    const url = `/delete_allow_module?id=${encodeURIComponent(paramValue)}&module_name=${moduleName}`;

    // Make an asynchronous request to delete the product from the server
    fetch(url, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
      },
    })
      .then(response => response.json())
      .then(data => {
        // Handle the response data
        // For example, display a success message or update the cart UI
        if (data.success) {
          // Handle the success response
          console.log('okkkkkkkkkkkkkkkkkkkkkkkk')
          li.remove()
          alertify.set('notifier', 'position', 'top-center');
          alertify.error('Module Removed!');
        }
        })
    
      .catch(error => {
        // Handle any errors that occurred during the request
        console.error(error);
      });
  });
  });
</script>
<script>
{% comment %} -------------------------------------------------------------------------------------------------------------- {% endcomment %}
  const removeBtns = document.querySelectorAll(".ip-del");
  // Attach an event listener to the delete button
  removeBtns.forEach(span => {
    span.addEventListener('click', (event) => {
      event.preventDefault(); // Prevent the default behavior of the button click

    // Get the product ID associated with the delete button
    li = span.parentElement
    
    const ipAddress = li.dataset.ipAddress;
    console.log(ipAddress);
    
    // Construct the URL with the confirmation code as a query parameter
    var queryString = window.location.search;
    // Create a new instance of URLSearchParams with the query string
    var searchParams = new URLSearchParams(queryString);
    // Get the value of the "param" query parameter
    var paramValue = searchParams.get('id');

    const url = `/delete_allow_ip?id=${encodeURIComponent(paramValue)}&ip_address=${ipAddress}`;

    // Make an asynchronous request to delete the product from the server
    fetch(url, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
      },
    })
      .then(response => response.json())
      .then(data => {
        // Handle the response data
        // For example, display a success message or update the cart UI
        if (data.success) {
          // Handle the success response
          li.remove()
          alertify.set('notifier', 'position', 'top-center');
          alertify.error(data.message);
        }
        })
    
      .catch(error => {
        // Handle any errors that occurred during the request
        console.error(error);
      });
  });
  });
</script>

<script>
  // Get the user delete modal
var modal = document.getElementById('productdeleteconfirm');

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target === modal) {
    modal.style.display = "none";
    document.getElementById('deleteconfirmation').style.display='none';
  };
};
</script>

<script>
  // Get references to the buttons
  const specificButton = document.getElementById('user-delete-btn');
  const removeButton = document.getElementById('remove-button');

  // Attach an event listener to the add button
  specificButton.addEventListener('click', () => {
    // Get the current URL
    const url = new URL(window.location.href);

    // Add the query parameter to the URL
    url.searchParams.append('del', 'true');

    // Modify the browser history with triggering a page reload
    window.location.href = url.href;
  });

  // Check if the 'del' query parameter exists in the URL
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has('del')) {
    const delEl = document.getElementById('productdeleteconfirm');
    const delEl2 = document.getElementById('deleteconfirmation');

    // Show the delEl element by modifying its style
    delEl.style.display = 'block';
    delEl2.style.display = 'block';
    document.getElementById('user-delete-btn').style.display='none';
  } 

  // Attach an event listener to the remove button
  removeButton.addEventListener('click', () => {
    // Get the current URL
    const url = new URL(window.location.href);

    // Remove the query parameter from the URL
    url.searchParams.delete('del');

    // Modify the browser history without triggering a page reload
    window.history.pushState({}, '', url.href);
    document.getElementById('user-delete-btn').style.display='block';
    document.getElementById('user-delete-btn').style.margin = '0 auto';
    document.getElementById('remove-button').style.marginTop = '-10px';
 
  });
</script>

<script>
  // Get a reference to the delete button
  const deleteButton = document.querySelector('.userdel');
  // Attach an event listener to the delete button
  deleteButton.addEventListener('click', (event) => {
    event.preventDefault(); // Prevent the default behavior of the button click

    // Get the product ID associated with the delete button
    const userId = deleteButton.dataset.userId;
    // Get the confirmation code from the input field
    const confirmationCode = document.getElementById('code').value;

    // Construct the URL with the confirmation code as a query parameter
    const url = `/my_products/users/delete_user/${userId}?code=${encodeURIComponent(confirmationCode)}`;

    // Make an asynchronous request to delete the product from the server
    fetch(url, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
      },
    })
      .then(response => response.json())
      .then(data => {
        // Handle the response data
        // For example, display a success message or update the cart UI
        if (data.success) {
          // Handle the success response
          const url = new URL(window.location.href);

          // Remove the query parameter from the URL
          url.searchParams.delete('del');

          // Modify the browser history without triggering a page reload
          window.location.href = url.href;
          alertify.set('notifier', 'position', 'top-center');
          alertify.success(data.message);
        } else if (data.error) {
          console.log('error');
          const errorEl = document.getElementById('code-error')
          errorEl.textContent = '• Invalid Code!'
        }
      })
      .catch(error => {
        // Handle any errors that occurred during the request
        console.error(error);
      });
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var allowIpsRadio = document.getElementById('allowips');
    var restrictIpsRadio = document.getElementById('restrictips');
    
    // Construct the URL with the confirmation code as a query parameter
    var queryString = window.location.search;
    // Create a new instance of URLSearchParams with the query string
    var searchParams = new URLSearchParams(queryString);
    // Get the value of the "param" query parameter
    var paramValue = searchParams.get('id');
    
    allowIpsRadio.addEventListener('change', function() {
      
      const url = `/allow_all_ip?id=${encodeURIComponent(paramValue)}`;
      // Make an asynchronous request to delete the product from the server
      fetch(url, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
        },
      })
        .then(response => response.json())
        .then(data => {
          // Handle the response data
          // For example, display a success message or update the cart UI
          if (data.success) {
            // Handle the success response
            alertify.set('notifier', 'position', 'top-center');
            alertify.success(data.message);
          }
        })
        .catch(error => {
          // Handle any errors that occurred during the request
          console.error(error);
        });
      });
    
    restrictIpsRadio.addEventListener('change', function() {
      
      const url = `/restrict_ip?id=${encodeURIComponent(paramValue)}`;
      // Make an asynchronous request to delete the product from the server
      fetch(url, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
        },
      })
        .then(response => response.json())
        .then(data => {
          // Handle the response data
          // For example, display a success message or update the cart UI
          if (data.success) {
            // Handle the success response
            alertify.set('notifier', 'position', 'top-center');
            alertify.success(data.message);
          }
        })
        .catch(error => {
          // Handle any errors that occurred during the request
          console.error(error);
        });
    });
  });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var restrictIpsRadio = document.getElementById('restrictips');
      var restrictIpsSection = document.getElementById('restrictipssection');
      
      restrictIpsRadio.addEventListener('change', function() {
        if (restrictIpsRadio.checked) {
          restrictIpsSection.style.display = 'block';
        } else {
          restrictIpsSection.style.display = 'none';
        }
      });
      
      // Initial check when the page loads
      if (restrictIpsRadio.checked) {
        restrictIpsSection.style.display = 'block';
      } else {
        restrictIpsSection.style.display = 'none';
      }
    });
  </script>
{% comment %} <script>
    console.log('first step')
  // Construct the URL with the confirmation code as a query parameter
  var queryString = window.location.search;
  // Create a new instance of URLSearchParams with the query string
  var searchParams = new URLSearchParams(queryString);
  // Get the value of the "param" query parameter
  var paramValue = searchParams.get('id');

  document.getElementById('time-restrict-btn').addEventListener('click', function() {
    var daysOfWeek = ['Saturday', 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
    var timeRestrictions = {};
    var validFormat = true;

    console.log('allah akbr')
    for (var i = 0; i < daysOfWeek.length; i++) {
      var startTime = document.getElementsByName('aftertime')[i].value;
      var endTime = document.getElementsByName('befortime')[i].value;
      
      if (!isValidTimeFormat(startTime) || !isValidTimeFormat(endTime)) {
        validFormat = false;
        alertify.set('notifier', 'position', 'top-center');
        alertify.error('Complete all days restrictions!');
        break;
      }
      
      timeRestrictions[daysOfWeek[i]] = [startTime, endTime];
    }
    if (validFormat) {
    // Send an AJAX request to the server to save the time restrictions
    var csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    var xhr = new XMLHttpRequest();
    xhr.open('POST', `/time_restrictions/?id=${encodeURIComponent(paramValue)}`, true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.setRequestHeader('X-CSRFToken', csrfToken);
    xhr.send(JSON.stringify(timeRestrictions));
    xhr.onload = function() {
      if (xhr.status === 200) {
        var response = JSON.parse(xhr.responseText);
        if (response.success) {
          // Time restrictions saved successfully
          alertify.set('notifier', 'position', 'top-center');
          alertify.success(response.message);
        } else if (response.error){
          // Handle the error case
          console.error(response.message);
        }
      } else {
        // Handle the error case
        console.error('Error:', xhr.status);
      }
    };
  }
  });

  // Function to validate the time format
  function isValidTimeFormat(time) {
  var timeRegex = /^(?:2[0-3]|[01][0-9]):[0-5][0-9](:[0-5][0-9](?:\.[0-9]{1,6})?)?$/;
  return timeRegex.test(time);
}

document.getElementById('remove-restrict-btn').addEventListener('click', function() {

  const url = `/remove_time_restrictions?id=${encodeURIComponent(paramValue)}`;
      // Make an asynchronous request to delete the product from the server
      fetch(url, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
        },
      })
        .then(response => response.json())
        .then(data => {
          // Handle the response data
          // For example, display a success message or update the cart UI
          if (data.success) {
            // Handle the success response
            alertify.set('notifier', 'position', 'top-center');
            alertify.success(data.message);
            var aftertimeElements = document.getElementsByName('aftertime');
            var befortimeElements = document.getElementsByName('befortime');

            for (var i = 0; i < aftertimeElements.length; i++) {
              aftertimeElements[i].value = '';
            }

            for (var j = 0; j < befortimeElements.length; j++) {
              befortimeElements[j].value = '';
            }
          } else if(data.error) {
            alertify.set('notifier', 'position', 'top-center');
            alertify.error(data.message);
          }
        })
        .catch(error => {
          // Handle any errors that occurred during the request
          console.error(error);
        });

});
</script> {% endcomment %}

<script>
  window.onscroll = function() {pagemapFunction()};
  
  var header = document.getElementById("myHeader");
  var sticky = header.offsetTop;
  
  function pagemapFunction() {
    if (window.pageYOffset > sticky) {
      header.classList.add("sticky");
    } else {
      header.classList.remove("sticky");
    }
  }
  </script> 
<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;
  
  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.Height){
        content.style.Height = "0px";
      } else {
        content.style.Height = content.scrollHeight + "px";
      } 
    });
  }
</script>
{% comment %} --------------------- save and cancel system user with js------------------------- {% endcomment %}
<script>
  const myForm = document.getElementById('system-user-form');
  const saveButton = document.querySelector('.usersavebtn');

  myForm.addEventListener('submit', function (event) {
      event.preventDefault(); // Prevent the default form submission

      const formData = new FormData(this);
      const userId = saveButton.dataset.userId;

      $.ajax({
          type: 'POST',
          url: `/my_products/users/save_system_user/${userId}`,
          data: formData,
          processData: false,
          contentType: false,
          headers: {
              'X-CSRFToken': getCookie('csrftoken'), // Include the CSRF token
          },
          success: function (data) {
              if (data.success) {
                  // Handle the success response
                  alertify.set('notifier', 'position', 'top-center');
                  alertify.success(data.message);
                  document.getElementById("psw").value = "";
                  document.getElementById("psw-repeat").value = "";
              } else if (data.error) {
                  alertify.set('notifier', 'position', 'top-center');
                  alertify.error(data.message);
                  

              }
          },
          error: function (error) {
              // Handle any errors that occurred during the request
              console.error('Error:', error);
          }
      });
  });

  function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
  }
{% comment %} ------------the cancel part--------------- {% endcomment %}
  const cancelButton = document.querySelector('.usercancelbtn');
  // Attach an event listener to the delete button
  cancelButton.addEventListener('click', (event) => {
    event.preventDefault(); // Prevent the default behavior of the button click
    
    setTimeout(() => {
      myForm.reset();
    }, 500);
  });

  
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Select all buttons with the class 'my-button'
    var buttons = document.querySelectorAll('.session-del-btn');
    var queryString = window.location.search;
    // Create a new instance of URLSearchParams with the query string
    var searchParams = new URLSearchParams(queryString);
    // Get the value of the "param" query parameter
    var paramValue = searchParams.get('id');
    // Iterate through each button and attach the event listener
    buttons.forEach(function (button) {
      button.addEventListener('click', function () {
        var session = button.dataset.sessionId;
        const sessionsTable = document.getElementById('sessions-table')
        console.log(sessionsTable)
        session_row = document.getElementById(session)
        session_row.remove()
        if (sessionsTable.rows.length < 2) {
          document.getElementById("onlineEl-inner").classList.remove('online');
          document.getElementById("onlineEl-inner").classList.add('offline');
          document.getElementById("onlineEl-inner").innerHTML = '&nbsp;&nbsp; offline &nbsp;&nbsp;'
          document.getElementById(`${paramValue}`).classList.remove('online');
          document.getElementById(`${paramValue}`).classList.add('offline');
          document.getElementById(`${paramValue}`).innerHTML = '&nbsp;&nbsp; offline &nbsp;&nbsp;'

          } 
        const url = `/session_delete/${session}`;
        // Make an asynchronous request to delete the product from the server
        fetch(url, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}' // Include the CSRF token
          },
        })
          .then(response => response.json())
          .then(data => {
            // Handle the response data
            // For example, display a success message or update the cart UI
            if (data.success) {
              // Handle the success response
              alertify.set('notifier', 'position', 'top-center');
              alertify.error(data.message);
            }
          })
          .catch(error => {
            // Handle any errors that occurred during the request
            console.error(error);
          });
      });
    });
  });
</script>
{% comment %} ----------------------------------------------------------------------- {% endcomment %}
{% endblock additional %}
